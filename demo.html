<!DOCTYPE html>
<meta charset="utf-8">
<html>
	<head>
		<title>BarcodeTester</title>
	</head>
	<body>
		<a href="http://eddiela.github.io/BarcodeReader" style="position:absolute;left:350px;">Main page</a>
		<img src="Sample-images/001.png" width="320" height="240" id="Image" style="position:absolute;left:0;top:0;border:10px groove silver" />
		<p id="Result" style="position:absolute;top:275px;"></p>
		<button style="position:absolute;top:260px;left:282px;padding:0;" type="button" width="30" id="NextImage">Next&ensp;&gt;&gt;</button>
		<button style="position:absolute;top:260px;left:104px;padding:0;" type="button" width="30" id="PreviousImage">&lt;&lt;&ensp;Previous</button>
		<button style="position:absolute;top:260px;left:192px;padding:0;" type="button" width="30" id="Decode">&gt;&gt;Decode&lt;&lt;</button>
		<script type="text/javascript">
			var c=document.createElement("canvas");
			var ctx=c.getContext("2d");
			var img = document.getElementById("Image");
			c.height=480;
			c.width=640;
			var workerCount = 0;
			var ResultOfDecoding = document.getElementById("Result")
			function receiveMessage(e) {
				if(e.data.success === "log") {
					console.log(e.data.result);
					return;
				}
				workerCount--;
				if(e.data.success){
					var tempArray = e.data.result;
					for(var i = 0; i < tempArray.length; i++) {
						if(resultArray.indexOf(tempArray[i]) == -1) {
							resultArray.push(tempArray[i]);
						}
					}
					ResultOfDecoding.innerHTML=resultArray.join("<br />");
					workerCount = 0;
				}else {
					if(workerCount == 1) {
						FlipWorker.postMessage({pixels: ctx.getImageData(0,0,c.width,c.height).data, cmd: "flip"});
					}
				}
				if(workerCount == 0){
					if(resultArray.length === 0) {
						ResultOfDecoding.innerHTML="Decoding failed.";
					}else {
						ResultOfDecoding.innerHTML=resultArray.join("<br />");
					}
				}
			}
			var DecodeWorker = new Worker("DecoderWorker.js");
			var FlipWorker = new Worker("DecoderWorker.js");
			DecodeWorker.onmessage = receiveMessage;
			FlipWorker.onmessage = receiveMessage;
			var resultArray = [];
			var prev = document.getElementById("PreviousImage");
			var next=document.getElementById("NextImage");
			var decode = document.getElementById("Decode");
			decode.addEventListener("click",Decode,false);
			next.addEventListener("click",NextImage,false);
			prev.addEventListener("click",PrevImage,false);
			ImageCounter=0;
			ImageList=["Sample-images/03.jpg","Sample-images/04.jpg","Sample-images/06 (2).jpg","Sample-images/06.jpg","Sample-images/07 (2).jpg","Sample-images/07.jpg","Sample-images/08 (2).jpg","Sample-images/code93.jpg","Sample-images/08.jpg","Sample-images/1 (2).JPG","Sample-images/1.gif","Sample-images/1.jpg","Sample-images/10 (2).JPG","Sample-images/10.jpg","Sample-images/11.jpg","Sample-images/12 (2).jpg","Sample-images/13 (2).jpg","Sample-images/13 (3).jpg","Sample-images/13 (4).jpg","Sample-images/136253222790411.gif","Sample-images/14 (2).jpg","Sample-images/15 (2).JPG","Sample-images/15 (3).jpg","Sample-images/15.jpg","Sample-images/16.jpg","Sample-images/17.jpg","Sample-images/1D2D.jpg","Sample-images/2.jpg","Sample-images/20 (2).JPG","Sample-images/20.jpg","Sample-images/20.png","Sample-images/21 (2).jpg","Sample-images/21.jpg","Sample-images/23.JPG","Sample-images/24.JPG","Sample-images/24.png","Sample-images/25.jpg","Sample-images/3037044282_c6396bc09a.jpg","Sample-images/31 (2).jpg","Sample-images/31.jpg","Sample-images/32.jpg","Sample-images/33.jpg","Sample-images/33.png","Sample-images/34.jpg","Sample-images/39.jpg","Sample-images/4.png","Sample-images/40.jpg","Sample-images/7 (2).JPG","Sample-images/7.jpg","Sample-images/7355ae1b-12eb-4e70-a650-f659.JPG","Sample-images/7784075_orig.gif","Sample-images/8.jpg","Sample-images/barcod.jpg","Sample-images/barcode-fax.gif","Sample-images/barcode-oldpaper.gif","Sample-images/barcode.jpg","Sample-images/barcode3.gif","Sample-images/barcodechart.gif","Sample-images/barcodeexample.gif","Sample-images/barcodes (3).jpg","Sample-images/barcodes2.jpg","Sample-images/barcode_code128.jpg","Sample-images/barcode_sc.png","Sample-images/Code128-C.bmp","Sample-images/Code128-warped.bmp","Sample-images/code128_barcode_label.jpg","Sample-images/code39.jpg","Sample-images/FrmI.jpg","Sample-images/getac_barcode_sw.jpg","Sample-images/image.jpg","Sample-images/bild.PNG","Sample-images/image002.jpg","Sample-images/Kris-Aura-SP8bc.jpg","Sample-images/ku-xlarge.jpg","Sample-images/mesk.jpg","Sample-images/Picture1.png","Sample-images/sample_bar_code_label.jpg","Sample-images/shipping_label_2d_barcode.jpg","Sample-images/Code93-C.bmp","Sample-images/mzl.isxtfluk.320x480-75.jpg","Sample-images/mzl.lfdqlrsn.320x480-75.jpg","Sample-images/mzl.uswzqyex.jpg","Sample-images/Product-Label.jpg","Sample-images/zebra-scan.jpg","Sample-images/standard_barcodes.jpg","Sample-images/WpHole.jpg","Sample-images/WP_000075.jpg"];
			ImageList.reverse();
			ImageList.slice().forEach( function(path) { new Image().src=path } );
			function NextImage(){
				if(workerCount > 0) return;
				ResultOfDecoding.innerHTML='';
				resultArray = [];
				ImageList.push(img.src);
				img.src=ImageList.shift();
				ImageCounter++;
				ImageCounter = ImageCounter>ImageList.length ? 0 : ImageCounter;
			}
			
			function PrevImage(){
				if(workerCount > 0) return;
				ResultOfDecoding.innerHTML='';
				resultArray = [];
				ImageList.unshift(img.src);
				img.src=ImageList.pop();
				ImageCounter--;
				ImageCounter = ImageCounter<0 ? ImageList.length : ImageCounter;
			}
			function Decode() {
				if(workerCount > 0) return;
				workerCount = 2;
				ResultOfDecoding.innerHTML='';
				resultArray = [];
				ctx.drawImage(img,0,0,c.width,c.height);
				DecodeWorker.postMessage({pixels: ctx.getImageData(0,0,c.width,c.height).data, cmd: "normal"});
			}
		</script>
	</body>
</html>
