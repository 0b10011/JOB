<!DOCTYPE html>
<meta charset=utf-8>
<html lang="en">
	<head>
		<title>JOB</title>
	</head>
	<body>
		<a href="StreamDemo.html" style="position:absolute;left:350px;">GetUserMedia Demo</a>
		<div id="container">
			<img width="320" height="240" src="about:blank" alt="" id="picture">
			<input id="Take-Picture" type="file" accept="image/*;capture=camera" />
			<p id="textbit"></p>
		</div>
		<script type="text/javascript" src="JOB.js"></script>
		<script type="text/javascript">
			var takePicture = document.querySelector("#Take-Picture"),
			showPicture = document.querySelector("#picture");
			Result = document.querySelector("#textbit");
			JOB.Init();
			var callback = function(result) {
				if(result.length > 0){
					var tempArray = [];
					for(var i = 0; i < result.length; i++) {
						tempArray.push(result[i].Format+" : "+result[i].Value);
					}
					Result.innerHTML=tempArray.join("<br />");
				}else{
					if(result.length === 0) {
						Result.innerHTML="Decoding failed.";
					}
				}
			};
			JOB.SetImageCallback(callback);
			if(takePicture && showPicture) {
				takePicture.onchange = function (event) {
					var files = event.target.files;
					if (files && files.length > 0) {
						file = files[0];
						try {
							var URL = window.URL || window.webkitURL;
							var imgURL = URL.createObjectURL(file);
							showPicture.src = imgURL;
							URL.revokeObjectURL(imgURL);
							DecodeBar();
						}
						catch (e) {
							try {
								var fileReader = new FileReader();
								fileReader.onload = function (event) {
									showPicture.src = event.target.result;
								};
								fileReader.readAsDataURL(file);
								DecodeBar();
							}
							catch (e) {
								Result.innerHTML = "Neither createObjectURL or FileReader are supported";
							}
						}
					}
				};
			}
			function DecodeBar(){
				showPicture.onload = function(){
					Result.innerHTML="";
					JOB.DecodeImage(showPicture);
				};
			}
		</script>
	</body>
</html>
